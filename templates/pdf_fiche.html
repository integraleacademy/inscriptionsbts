<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<style>
  body {
    font-family: 'Segoe UI', 'Segoe UI Emoji', 'Apple Color Emoji', Arial, sans-serif;
    font-size: 11.5px;
    color: #222;
    margin: 40px;
    background: #fff;
  }

  header {
    display: flex;
    align-items: center;
    border-bottom: 3px solid #f4c45a;
    padding-bottom: 10px;
    margin-bottom: 25px;
  }

  header img {
    height: 70px;
    margin-right: 20px;
  }

  header h1 {
    font-size: 20px;
    margin: 0;
    color: #111;
  }

  .sub-info {
    font-size: 13px;
    color: #555;
    margin-top: 3px;
  }

  h2 {
    background: #f4c45a;
    color: #111;
    font-size: 13.5px;
    padding: 6px 10px;
    border-radius: 6px;
    margin-top: 25px;
  }

  .box {
    border: 1px solid #ddd;
    border-radius: 6px;
    padding: 8px 10px;
    margin-bottom: 6px;
    background: #fafafa;
  }

  .label {
    font-weight: 600;
    color: #111;
  }

  .nir-box {
    border: 2px solid #f4c45a;
    background: #fffbea;
    padding: 10px;
    font-size: 13px;
    font-weight: bold;
    text-align: center;
    margin: 20px 0;
    border-radius: 8px;
  }

  footer {
    text-align: right;
    font-style: italic;
    font-size: 10px;
    color: #555;
    margin-top: 25px;
  }
</style>
</head>
<body>

{% set QUALITES = {
  'rigoureux': 'Rigueur',
  'organise': 'Organisation',
  'autonome': 'Autonomie',
  'communication': 'Communication',
  'esprit_equipe': 'Esprit d’équipe',
  'curieux': 'Curiosité',
  'leadership': 'Leadership',
  'creatif': 'Créativité',
  'empathique': 'Empathie',
  'serieux': 'Sérieux'
} %}
{% set MOTIVATIONS = {
  'reussite': 'La réussite personnelle et professionnelle',
  'stabilite': 'La stabilité et la sécurité de l’emploi',
  'utilite': 'Être utile et aider les autres',
  'defis': 'Les défis et les responsabilités',
  'contact': 'Le contact humain et le travail d’équipe',
  'innovation': 'L’innovation et les nouvelles technologies',
  'evolution': 'Les perspectives d’évolution',
  'apprentissage': 'L’envie d’apprendre et de me perfectionner'
} %}
{% set VALEURS = {
  'salaire': 'Un bon salaire et des avantages',
  'sens': 'Un métier qui a du sens',
  'contact': 'Être en contact avec le public',
  'mobilite': 'Pouvoir bouger et voyager',
  'stabilite': 'La stabilité et la sécurité de l’emploi',
  'responsabilite': 'Des responsabilités importantes',
  'autonomie': 'Travailler de manière autonome',
  'equipe': 'Un bon esprit d’équipe'
} %}
{% set TRAVAIL = {
  'methodique': 'Je suis méthodique et j’aime planifier',
  'pratique': 'J’apprends mieux en pratiquant',
  'collaboratif': 'J’aime travailler en groupe',
  'independant': 'Je préfère travailler seul(e)',
  'creatif': 'J’aime proposer des idées nouvelles',
  'objectif': 'Je me fixe des objectifs précis'
} %}

<header>
  <img src="{{ url_for('static', filename='logo-integrale.png') }}" alt="Logo Intégrale Academy">
  <div>
    <h1>{{ row.nom|upper }} {{ row.prenom|title }}</h1>
    <div class="sub-info">
      {{ row.bts|btsfull }} —
      {% if row.mode == "presentiel" %}🧑‍🏫 Présentiel
      {% elif row.mode == "distanciel" %}💻 Distanciel
      {% else %}{{ row.mode }}{% endif %}<br>
      <strong>Dossier n° {{ row.numero_dossier }}</strong>
    </div>
  </div>
</header>

<div class="box">
  <span class="label">Formulaire envoyé le :</span> {{ row.created_at|dmy }}
</div>

<h2>1. INFORMATIONS PERSONNELLES</h2>

<div class="box"><span class="label">Nom :</span> {{ row.nom }}</div>
<div class="box"><span class="label">Prénom :</span> {{ row.prenom }}</div>
<div class="box"><span class="label">Date de naissance :</span> {{ row.date_naissance|dmy }}</div>
<div class="box"><span class="label">Pays de naissance :</span> {{ row.pays_naissance }}</div>
<div class="box"><span class="label">Code postal de naissance :</span> {{ row.cp_naissance }}</div>
<div class="box"><span class="label">Ville de naissance :</span> {{ row.ville_naissance }}</div>

{% if row.est_mineur %}
<div class="box">
  <span class="label">Responsable légal :</span><br>
  {{ row.resp_prenom }} {{ row.resp_nom }}<br>
  📧 {{ row.resp_email }} — 📞 {{ row.resp_tel }}
</div>
{% endif %}

<div class="box"><span class="label">Adresse postale :</span> {{ row.adresse }}</div>
<div class="box"><span class="label">Code postal :</span> {{ row.cp }}</div>
<div class="box"><span class="label">Ville :</span> {{ row.ville }}</div>
<div class="box"><span class="label">E-mail :</span> {{ row.email }}</div>
<div class="box"><span class="label">Téléphone :</span> {{ row.tel }}</div>
<div class="box"><span class="label">Permis B :</span> {% if row.permis_b %}✅ Oui{% else %}❌ Non{% endif %}</div>

<div class="nir-box">
  N° de Sécurité sociale : {{ row.num_secu|nirsp }}
</div>

<h2>2. ANTÉRIORITÉ SCOLAIRE</h2>
<div class="box">
  <span class="label">Baccalauréat :</span>
  {% set bac = row.baccalaureat or row.bac_status or "" %}
  {% if 'oui' in bac.lower() %}✅ Oui
  {% elif 'non' in bac.lower() %}❌ Non
  {% elif '2026' in bac or 'prévu' in bac.lower() %}📅 Prévu en 2026
  {% else %}—
  {% endif %}
</div>
<div class="box"><span class="label">Type de bac :</span> {{ row.bac_type or "—" }}</div>
<div class="box"><span class="label">Autre formation / précisions :</span> {{ row.bac_autre or "—" }}</div>

<h2>3. FORMATION CHOISIE</h2>
<div class="box"><span class="label">Formation :</span> {{ row.bts|btsfull }}</div>
<div class="box"><span class="label">Mode de formation :</span> {% if row.mode == "presentiel" %}🧑‍🏫 Présentiel{% elif row.mode == "distanciel" %}💻 Distanciel{% else %}{{ row.mode }}{% endif %}</div>

{% if row.mos_parcours %}
  <div class="box"><span class="label">Parcours sécurité :</span> {{ row.mos_parcours }}</div>
{% endif %}

<div class="box">
  <span class="label">Formation APS souhaitée :</span>
  {% if row.aps_souhaitee|int == 1 %}
    ✅ Oui<br><span class="label">Session APS :</span> {{ row.aps_session or "—" }}
  {% else %}
    ❌ Non
  {% endif %}
</div>

<h2>4. 💬 PROJET MOTIVÉ</h2>
<div class="box"><span class="label">Pourquoi souhaitez-vous intégrer ce BTS ?</span><br>🎯 {{ row.projet_pourquoi or "—" }}</div>
<div class="box"><span class="label">Quel est votre projet professionnel ?</span><br>🚀 {{ row.projet_objectif or "—" }}</div>
<div class="box"><span class="label">Vos passions / centres d’intérêt :</span><br>❤️ {{ row.projet_passions or "—" }}</div>

<div class="box"><span class="label">Vos principales qualités :</span><br>🌟
  {% set items = (row.projet_qualites or '').split(',') %}
  {% if items %}
    {% for q in items %}
      {{ QUALITES[q.strip().lower()] or q.strip() }}{% if not loop.last %}, {% endif %}
    {% endfor %}
  {% else %}—
  {% endif %}
</div>

<div class="box"><span class="label">Ce qui vous motive le plus :</span><br>🔥
  {% set items = (row.projet_motivation or '').split(',') %}
  {% if items %}
    {% for m in items %}
      {{ MOTIVATIONS[m.strip().lower()] or m.strip() }}{% if not loop.last %}, {% endif %}
    {% endfor %}
  {% else %}—
  {% endif %}
</div>

<div class="box"><span class="label">Ce que vous recherchez dans votre futur métier :</span><br>💼
  {% set items = (row.projet_recherche or '').split(',') %}
  {% if items %}
    {% for v in items %}
      {{ VALEURS[v.strip().lower()] or v.strip() }}{% if not loop.last %}, {% endif %}
    {% endfor %}
  {% else %}—
  {% endif %}
</div>

<div class="box"><span class="label">Votre manière de travailler :</span><br>🧠
  {% set items = (row.projet_travail or '').split(',') %}
  {% if items %}
    {% for t in items %}
      {{ TRAVAIL[t.strip().lower()] or t.strip() }}{% if not loop.last %}, {% endif %}
    {% endfor %}
  {% else %}—
  {% endif %}
</div>

<footer>
  Fiche générée le {{ now.strftime('%d/%m/%Y %H:%M') }} — Intégrale Academy
</footer>

</body>
</html>
