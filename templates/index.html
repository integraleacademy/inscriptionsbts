{% extends "base.html" %}
{% block content %}

{% if portal_closed %}
  <div style="max-width:700px;margin:80px auto;padding:40px;text-align:center;background:#fff;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.05);">
    <h2 style="color:#222;margin-bottom:20px;">âš ï¸ Portail temporairement indisponible</h2>
    <p style="font-size:1.1em;color:#444;line-height:1.6;">
      {{ portal_message or "Les prÃ©-inscriptions sont actuellement fermÃ©es. Veuillez rÃ©essayer plus tard." }}
    </p>

    {% if portal_comment %}
      <p style="margin-top:15px;font-size:0.95em;color:#555;background:#fff8e1;border-left:4px solid #f4c45a;padding:10px 15px;border-radius:8px;display:inline-block;text-align:left;">
        ğŸ—’ï¸ <em>{{ portal_comment }}</em>
      </p>
    {% endif %}
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.querySelector(".form-container");
      if (form) form.style.display = "none";
    });
  </script>
{% endif %}


<div class="form-container">
  <h2>ğŸ“ PrÃ©-inscriptions BTS 2026</h2>

  <div style="margin:20px 0;padding:20px;border:2px solid #f4c45a;background:#fff8e1;border-radius:10px;">
  <h3 style="margin-top:0;">ğŸ¤ PÃ´le Alternance (test dâ€™affichage)</h3>
  <p>Si vous voyez ce message, le code fonctionne bien et Render utilise la bonne version du fichier.</p>
</div>



  <div class="notice">
    <p>Vous allez complÃ©ter votre dossier de prÃ©-inscription pour intÃ©grer lâ€™un de nos BTS Ã  partir de septembre 2026.</p>
    <ol>
      <li>ComplÃ©tez ce formulaire. Vous recevrez ensuite un <strong>accusÃ© de rÃ©ception</strong> avec votre numÃ©ro de dossier.</li>
      <li>Dans un dÃ©lai de 15 jours, nous Ã©tudierons votre dossier et vous recevrez notre <em>avis dâ€™admission</em>.</li>
      <li>En cas dâ€™avis favorable, vous pourrez confirmer votre inscription en cliquant sur <strong>Â« Je confirme mon inscription Â»</strong>.</li>
    </ol>
    <p class="help">Besoin dâ€™aide ? <a href="https://assistance-alw9.onrender.com/" target="_blank">Cliquez ici</a> ou appelez le <strong>04 22 47 07 68</strong>.</p>
  </div>

  <!-- âœ… Message de confirmation dynamique -->
<div id="flashMessage" class="flash-message hidden"></div>

  <!-- ğŸš€ Ã‰cran dâ€™introduction -->
<div id="intro-screen" class="intro-screen">
  <h2>ğŸ•’ Avant de commencer votre prÃ©-inscription</h2>
  <p>Cette dÃ©marche dure environ <strong>5 minutes</strong>.</p>
  <p>Merci de prÃ©parer Ã  portÃ©e de main :</p>
  <ul>
    <li>ğŸªª Votre <strong>piÃ¨ce dâ€™identitÃ© (recto/verso)</strong></li>
    <li>ğŸ’³ Votre <strong>carte Vitale</strong></li>
    <li>ğŸ“¸ Une <strong>photo dâ€™identitÃ©</strong></li>
    <li>ğŸ“„ Votre <strong>CV</strong></li>
    <li>ğŸ–‹ï¸ Votre <strong>lettre de motivation</strong></li>
  </ul>
  <p>ğŸ”’ Toutes vos donnÃ©es sont sauvegardÃ©es et sÃ©curisÃ©es.</p>
  <button id="startForm" class="btn primary" style="margin-top:15px;">ğŸš€ Commencer ma prÃ©-inscription</button>
</div>

  <style>
.intro-screen {
  text-align:center;
  background:#fff8e1;
  border-left:5px solid #f4c45a;
  border-radius:10px;
  padding:30px;
  margin-bottom:30px;
  animation: fadeIn 0.4s ease;
}
.intro-screen ul {
  list-style:none;
  padding:0;
  margin:10px 0 20px 0;
}
.intro-screen li {
  font-size:16px;
  margin:5px 0;
}
@keyframes fadeIn {
  from { opacity:0; transform:translateY(-10px); }
  to { opacity:1; transform:translateY(0); }
}
</style>


  <form id="inscriptionForm" class="tabs-form" method="post" action="{{ url_for('submit') }}" enctype="multipart/form-data">
    <div class="tabs">
      <button type="button" data-tab="tab1" class="active">ğŸªª Infos gÃ©nÃ©rales</button>
      <button type="button" data-tab="tab2">ğŸ“ Formation</button>
      <button type="button" data-tab="tab3">ğŸ§© Infos complÃ©mentaires</button>
      <button type="button" data-tab="tab4">ğŸ’¬ Projet motivÃ©</button>
      <button type="button" data-tab="tab5">ğŸ“ PiÃ¨ces justificatives</button>
    </div>

      <!-- ğŸ”¢ Barre de progression -->
<div class="progress-container">
  <div class="progress-bar" id="progressBar"></div>
</div>

  <div class="progress-info" id="progressInfo">Ã‰tape 1 sur 5</div>

    <!-- ğŸªª Ã‰tape 1 -->
    <div id="tab1" class="tab active">
      <div class="grid">
        <label>Nom <input name="nom" required></label>
        <label>PrÃ©nom <input name="prenom" required></label>
        <label>Sexe
          <select name="sexe" required>
            <option value="">â€”</option>
            <option>Homme</option>
            <option>Femme</option>
          </select>
        </label>
        <label>Date de naissance <input type="date" name="date_naissance" required></label>
        <!-- Bloc Responsable LÃ©gal (cachÃ© par dÃ©faut) -->
<div id="bloc-resp-legal" style="display:none; margin-top:20px; background:#fff8e1; padding:15px; border-left:4px solid #f4c45a; border-radius:8px;">
  <h4>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Informations du responsable lÃ©gal</h4>
  <p style="font-size:14px; color:#555;">âš ï¸ Vous Ãªtes mineur(e) Ã  la date dâ€™inscription â€” merci dâ€™indiquer les coordonnÃ©es du responsable lÃ©gal :</p>
  
  <div class="grid">
    <label>Nom du responsable lÃ©gal <input name="resp_nom"></label>
    <label>PrÃ©nom du responsable lÃ©gal <input name="resp_prenom"></label>
    <label>Email du responsable lÃ©gal <input type="email" name="resp_email"></label>
    <label>TÃ©lÃ©phone du responsable lÃ©gal <input name="resp_tel" pattern="\d{10}"></label>
  </div>
  <input type="hidden" name="est_mineur" id="est_mineur" value="0">
</div>

        <label>Ville de naissance <input name="ville_naissance" required></label>
        <label>Code postal de naissance <input name="cp_naissance" required></label>
        <label>Pays de naissance <input name="pays_naissance" required></label>
<label>NumÃ©ro de sÃ©curitÃ© sociale
  <input 
    name="num_secu"
    id="num_secu"
    type="text"
    inputmode="text"
    maxlength="15"
    required
    placeholder="Ex : 2842A12345678946"
    oninput="this.value = this.value.toUpperCase().replace(/[^0-9AB]/g, '').slice(0,15); verifierNumSecu();"
  >
  <small id="numSecuHelp" style="color:#666;font-size:13px;">15 caractÃ¨res attendus (chiffres ou A/B pour la Corse)</small>
</label>


        <label>Email <input type="email" name="email" required></label>
        <label>Confirmer lâ€™email <input type="email" name="email_confirm" required></label>
        <label>TÃ©lÃ©phone portable <input name="tel" pattern="\d{10}" required></label>
        <label>Adresse postale <input name="adresse" required></label>
        <label>Code postal <input name="cp" required></label>
        <label>Ville <input name="ville" required></label>
      </div>
      <div class="actions nav-global">
  <button type="button" class="btn primary next">â¡ï¸ Ã‰tape suivante</button>
  <button type="button" class="btn save">ğŸ’¾ Enregistrer et reprendre plus tard</button>
</div>

    </div>

    <!-- ğŸ“ Ã‰tape 2 -->
<div id="tab2" class="tab">
  <label>Formation souhaitÃ©e
    <select name="bts" required>
      <option value="">â€”</option>
      <option value="MOS">BTS MOS (SÃ©curitÃ©)</option>
      <option value="MCO">BTS MCO</option>
      <option value="PI">BTS PI</option>
      <option value="CI">BTS CI</option>
      <option value="NDRC">BTS NDRC</option>
      <option value="CG">BTS ComptabilitÃ©-Gestion</option>
    </select>
  </label>

  <!-- Bloc dâ€™informations sur la formation sÃ©lectionnÃ©e -->
<div id="formation-info" 
     style="display:none; margin-top:15px; padding:15px; border-left:4px solid #f4c45a; background:#fff8e1; border-radius:10px;">
</div>



<div class="formation-mode" style="margin-top:20px;">
  <h3>ğŸ¯ Je souhaite suivre la formation :</h3>
  <p style="font-size:15px; color:#444; margin-bottom:15px;">
    Deux formats sont possibles selon votre situation : le mÃªme diplÃ´me, la mÃªme exigence, 
    mais deux faÃ§ons de suivre votre parcours.
  </p>

  <div style="display:flex; gap:20px; flex-wrap:wrap; justify-content:center;">
    <!-- ğŸ§‘â€ğŸ« PrÃ©sentiel -->
    <label class="mode-btn presentiel" style="flex:1; min-width:260px; max-width:360px; background:#fff3cd; border:2px solid #f4c45a; border-radius:14px; padding:24px; text-align:center; cursor:pointer; transition:all .3s ease;">
      <input type="radio" name="mode" value="presentiel" style="display:none;">
      <div style="font-size:20px; font-weight:600;">ğŸ§‘â€ğŸ« Formation en prÃ©sentiel</div>
      <p style="margin:10px 0 0; font-size:15px; color:#333;">
        Suivez vos cours dans les locaux <strong>IntÃ©grale Academy</strong><br>
        Ã  <strong>Puget-sur-Argens (Var â€“ 83)</strong>.<br>
        Accompagnement individuel, vie de promo et immersion professionnelle.
      </p>
    </label>

    <!-- ğŸ’» Distanciel -->
    <label class="mode-btn distanciel" style="flex:1; min-width:260px; max-width:360px; background:#eaf7ff; border:2px solid #007bff33; border-radius:14px; padding:24px; text-align:center; cursor:pointer; transition:all .3s ease;">
      <input type="radio" name="mode" value="distanciel" style="display:none;">
      <div style="font-size:20px; font-weight:600;">ğŸ’» Formation 100 % Ã  distance</div>
      <p style="margin:10px 0 0; font-size:15px; color:#333;">
        Suivez la mÃªme formation depuis chez vous, en <strong>visioconfÃ©rence en direct</strong><br>
        avec nos enseignants. Un suivi personnalisÃ© et un accompagnement Ã  distance de qualitÃ©.
      </p>
    </label>
  </div>

  <div style="margin-top:18px; background:#fff8e1; border-left:4px solid #f4c45a; padding:12px 18px; border-radius:10px;">
    <p style="margin:0; font-size:15px; color:#444;">
      ğŸ§¾ <strong>Ã€ savoir :</strong> quel que soit le format choisi, 
      <strong>lâ€™examen final</strong> se dÃ©roulera en fin de 2áµ‰ annÃ©e, 
      soit au sein de <strong>lâ€™acadÃ©mie de Paris</strong>, 
      soit au sein de <strong>lâ€™acadÃ©mie de Nice</strong>.
    </p>
  </div>
</div>

<style>
  /* ğŸŒŸ Effets visuels IntÃ©grale Academy */
  .mode-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 14px rgba(0,0,0,0.12);
  }
  .mode-btn.presentiel:hover {
    background:#fff0b3;
    border-color:#f4c45a;
  }
  .mode-btn.distanciel:hover {
    background:#d6eeff;
    border-color:#007bff66;
  }
  .mode-btn.selected {
    outline:3px solid #f4c45a;
    background:#fff8e1 !important;
  }
</style>




  
 <!-- ğŸŸ¢ Bloc spÃ©cifique BTS MOS SÃ©curitÃ© -->
<div id="mos-section" class="mos" style="display:none; margin-top:20px;">

  <h4>Ã€ cocher, une seule case possible :</h4>

  <label>
    <input type="radio" name="bac_status" value="bac_ms">
    Je suis titulaire dâ€™un Bac Pro MS mÃ©tiers de la sÃ©curitÃ©
  </label><br>

  <label>
    <input type="radio" name="bac_status" value="bac_ms_en_cours">
    Je passe mon Bac Pro MS mÃ©tiers de la sÃ©curitÃ© en 2026
  </label><br>

  <label>
    <input type="radio" name="bac_status" value="carte_cnaps">
    Je suis dÃ©jÃ  titulaire dâ€™une carte professionnelle CNAPS
  </label><br>

  <label>
    <input type="radio" name="bac_status" value="autre">
    Aucun de ces cas (bac gÃ©nÃ©ral, bac technologique, bac pro hors MS, autre)
  </label>

  <!-- Zone affichÃ©e si "autre" -->
  <div id="bloc-bac-autre" style="display:none; margin-top:10px;">
    <label>
      PrÃ©ciser (si autre) :
      <input type="text" name="bac_autre" placeholder="Ex : Bac gÃ©nÃ©ral STMG">
    </label>
  </div>

  <!-- Bloc explicatif + choix APS -->
  <div id="mos-explication" style="display:none; margin-top:15px; background:#fff8e1; padding:15px; border-left:4px solid #f4c45a; border-radius:8px;">
    <p>
      Pour accÃ©der Ã  notre <strong>BTS Management OpÃ©rationnel de la SÃ©curitÃ© (MOS)</strong>,
      vous devez Ãªtre titulaire dâ€™une <strong>carte professionnelle â€œagent de sÃ©curitÃ© privÃ©eâ€</strong>
      dÃ©livrÃ©e par le MinistÃ¨re de lâ€™intÃ©rieur (CNAPS).
    </p>
    <p>
      Cette carte professionnelle vous sera demandÃ©e par votre future entreprise dans le cadre de lâ€™alternance.
    </p>
    <p>
      â¡ï¸ <a href="https://www.canva.com/design/DAFyt9PCLzk/crHFPARJiocR1wDYdodMJw/view?utm_content=DAFyt9PCLzk&utm_campaign=designshare&utm_medium=link&utm_source=editor"
      target="_blank" style="color:#007bff; font-weight:600;">Plus dâ€™infos sur le CNAPS ici</a>
    </p>
    <p>
      Cette formation est proposÃ©e au tarif <strong>950 â‚¬ (apprenti)</strong> au lieu de 1650 â‚¬.
      Le chÃ¨que sera Ã  envoyer par courrier lorsque nous aurons confirmÃ© votre inscription.
    </p>

<div id="bloc-aps-radios">
  <p><strong>Souhaitez-vous suivre la formation APS ?</strong></p>

  <label>
    <input type="radio" name="aps_souhaitee" value="oui">
    Oui, je souhaite suivre la formation agent de sÃ©curitÃ© privÃ©e (APS)
  </label><br>

  <label>
    <input type="radio" name="aps_souhaitee" value="non">
    Non, je ne souhaite pas suivre cette formation
  </label>
</div>


<!-- Bloc session APS -->
<div id="bloc-aps-session" style="display:none; margin-top:10px;">
  <p><strong>Choisissez votre session :</strong></p>
  <label>
    <input type="radio" name="aps_session" value="puget">
    8 juillet â†’ 12 aoÃ»t 2026 â€” IntÃ©grale Academy (Puget-sur-Argens)
  </label><br>
  <label>
    <input type="radio" name="aps_session" value="autre">
    7 septembre â†’ 9 octobre 2026 â€” IntÃ©grale Academy (Puget-sur-Argens)
  </label>
</div>

<!-- Bloc raison NON APS -->
<div id="raison-non-aps" style="display:none; margin-top:10px;">
  <label for="raison_aps"><strong>Pour quelle raison ?</strong></label>
  <textarea name="raison_aps" rows="2" placeholder="Merci de prÃ©ciser votre raison ici..."></textarea>
</div>

  </div>
</div>



  <!-- Boutons d'Ã©tape -->
<div class="actions nav-global">
  <button type="button" class="btn prev">â¬…ï¸ Ã‰tape prÃ©cÃ©dente</button>
  <button type="button" class="btn primary next">â¡ï¸ Ã‰tape suivante</button>
  <button type="button" class="btn save">ğŸ’¾ Enregistrer et reprendre plus tard</button>
</div>

</div> <!-- fin tab2 -->


 <!-- ğŸ§© Ã‰tape 3 -->
<div id="tab3" class="tab">
  <div class="grid">
    <label>BaccalaurÃ©at
      <select name="baccalaureat" required>
        <option value="">â€”</option>
        <option>Oui</option>
        <option>Non</option>
        <option>PrÃ©vu en 2026</option>
      </select>
    </label>
    <label>Type de bac
      <select name="bac_type">
        <option value="">â€”</option>
        <option>GÃ©nÃ©ral</option>
        <option>Technologique</option>
        <option>Professionnel</option>
        <option>Autre</option>
      </select>
    </label>
    <label>Si â€œAutreâ€, prÃ©ciser <input name="bac_autre"></label>
    <label>Permis B
      <select name="permis_b">
        <option value="">â€”</option>
        <option>Oui</option>
        <option>Non</option>
      </select>
    </label>
  </div>

  <!-- ğŸ”¹ Contrat d'apprentissage - Entreprise d'accueil -->
  <div class="apprentissage-box">
    <h3>ğŸ“‘ Contrat dâ€™apprentissage â€“ Entreprise dâ€™accueil</h3>

    <label>Jâ€™ai dÃ©jÃ  trouvÃ© une entreprise pour mon alternance :</label>
    <div class="radio-row">
      <label><input type="radio" name="entreprise_trouvee" value="oui" required> Oui</label>
      <label><input type="radio" name="entreprise_trouvee" value="non" required> Non</label>
    </div>

    <label>Jâ€™ai dÃ©jÃ  commencÃ© mes recherches :</label>
    <div class="radio-row">
      <label><input type="radio" name="recherches_commencees" value="oui" required> Oui</label>
      <label><input type="radio" name="recherches_commencees" value="non" required> Non</label>
    </div>

    <!-- === ğŸ¤ ENCADRÃ‰ PÃ”LE ALTERNANCE === -->
    <div class="pole-alternance-box" style="margin-top:25px;background:#fff8e1;border:2px solid #f4c45a;border-radius:12px;padding:25px;">
      <div style="display:flex;align-items:center;gap:15px;flex-wrap:wrap;">
        <img src="/static/logo-integrale.png" alt="Logo IntÃ©grale Academy" style="height:60px;border-radius:50%;background:white;padding:5px;">
        <div style="flex:1;">
          <h3 style="margin:0;font-size:20px;color:#222;">ğŸ¤ PÃ´le Alternance Ãle-de-France</h3>
          <p style="margin:6px 0 0;font-size:15px;color:#444;">
            DÃ¨s validation de votre prÃ©-inscription, notre partenaire PÃ´le Alternance peut vous aider Ã  trouver une entreprise dâ€™accueil.
          </p>
        </div>
      </div>

      <div style="margin-top:20px;">
        <label style="display:block;margin-bottom:8px;font-size:15px;">
          <input type="radio" name="souhaite_accompagnement" value="oui" required>
          Je souhaite Ãªtre accompagnÃ© pour trouver une entreprise
        </label>
        <label style="display:block;font-size:15px;">
          <input type="radio" name="souhaite_accompagnement" value="non">
          Je prÃ©fÃ¨re chercher une entreprise par moi-mÃªme
        </label>
      </div>
    </div>

    <div class="apprentissage-info" style="margin-top:25px;">
      ğŸ’¡ <strong>Rassurez-vous&nbsp;!</strong> Vous aurez jusquâ€™au <strong>15 dÃ©cembre 2026</strong> pour trouver votre entreprise dâ€™accueil.<br>
      Les cours commenceront en <strong>septembre</strong>, mÃªme si vous n'avez pas signÃ© de contrat d'apprentissage.<br>
      La plupart des Ã©tudiants trouvent leur entreprise dans les semaines qui suivent la rentrÃ©e, entre <strong>octobre et novembre</strong>.
    </div>
  </div> <!-- fin apprentissage-box -->

  <div class="actions nav-global">
    <button type="button" class="btn prev">â¬…ï¸ Ã‰tape prÃ©cÃ©dente</button>
    <button type="button" class="btn primary next">â¡ï¸ Ã‰tape suivante</button>
    <button type="button" class="btn save">ğŸ’¾ Enregistrer et reprendre plus tard</button>
  </div>
</div> <!-- fin tab3 -->





     
<!-- ===================================================== -->
<!-- ğŸ’¬ Ã‰TAPE 4 : PROJET MOTIVÃ‰ (version finale Ã©lÃ©gante) -->
<!-- ===================================================== -->
<div class="tab" id="tab4">
  <h3>ğŸ’¬ Projet motivÃ©</h3>
  <p>
    Cette Ã©tape nous permet de mieux connaÃ®tre vos motivations et votre profil. 
    RÃ©pondez simplement et sincÃ¨rement.
  </p>

  <label>
    Quâ€™est-ce qui vous motive Ã  suivre cette formation ?
    <textarea name="projet_pourquoi" placeholder="Expliquez en quelques lignes ce qui vous attire dans cette formation (ex : dÃ©bouchÃ©s, projet professionnel, reconversion...)"></textarea>
  </label>

  <label>
    Quels sont vos projets ou objectifs aprÃ¨s lâ€™obtention de votre diplÃ´me ?
    <textarea name="projet_objectif" placeholder="Exemple : poursuivre mes Ã©tudes, trouver un emploi rapidement, crÃ©er mon entreprise..."></textarea>
  </label>

  <hr>

  <h4>ğŸ’¡ Vos principales qualitÃ©s</h4>
  <p>SÃ©lectionnez celles qui vous reprÃ©sentent le mieux :</p>
  <div class="etiquettes">
    <label><input type="checkbox" name="qualites[]" value="rigoureux"> Rigueur</label>
    <label><input type="checkbox" name="qualites[]" value="organise"> Organisation</label>
    <label><input type="checkbox" name="qualites[]" value="autonome"> Autonomie</label>
    <label><input type="checkbox" name="qualites[]" value="communication"> Communication</label>
    <label><input type="checkbox" name="qualites[]" value="esprit_equipe"> Esprit dâ€™Ã©quipe</label>
    <label><input type="checkbox" name="qualites[]" value="curieux"> CuriositÃ©</label>
    <label><input type="checkbox" name="qualites[]" value="leadership"> Leadership</label>
    <label><input type="checkbox" name="qualites[]" value="creatif"> CrÃ©ativitÃ©</label>
    <label><input type="checkbox" name="qualites[]" value="empathique"> Empathie</label>
    <label><input type="checkbox" name="qualites[]" value="serieux"> SÃ©rieux</label>
  </div>

  <hr>

  <h4>ğŸš€ Ce qui vous motive le plus dans vos Ã©tudes ou votre futur mÃ©tier</h4>
  <div class="etiquettes">
    <label><input type="checkbox" name="motivation[]" value="reussite"> La rÃ©ussite personnelle et professionnelle</label>
    <label><input type="checkbox" name="motivation[]" value="stabilite"> La stabilitÃ© et la sÃ©curitÃ© de lâ€™emploi</label>
    <label><input type="checkbox" name="motivation[]" value="utilite"> ÃŠtre utile et aider les autres</label>
    <label><input type="checkbox" name="motivation[]" value="defis"> Les dÃ©fis et les responsabilitÃ©s</label>
    <label><input type="checkbox" name="motivation[]" value="contact"> Le contact humain et le travail dâ€™Ã©quipe</label>
    <label><input type="checkbox" name="motivation[]" value="innovation"> Lâ€™innovation et les nouvelles technologies</label>
    <label><input type="checkbox" name="motivation[]" value="evolution"> Les perspectives dâ€™Ã©volution</label>
    <label><input type="checkbox" name="motivation[]" value="apprentissage"> Lâ€™envie dâ€™apprendre et de me perfectionner</label>
  </div>

  <hr>

  <h4>ğŸ’¼ Ce que vous recherchez avant tout dans votre futur mÃ©tier</h4>
  <div class="etiquettes">
    <label><input type="checkbox" name="valeurs[]" value="salaire"> Un bon salaire et des avantages</label>
    <label><input type="checkbox" name="valeurs[]" value="sens"> Un mÃ©tier qui a du sens</label>
    <label><input type="checkbox" name="valeurs[]" value="contact"> ÃŠtre en contact avec le public</label>
    <label><input type="checkbox" name="valeurs[]" value="mobilite"> Pouvoir bouger et voyager</label>
    <label><input type="checkbox" name="valeurs[]" value="stabilite"> La stabilitÃ© et la sÃ©curitÃ© de lâ€™emploi</label>
    <label><input type="checkbox" name="valeurs[]" value="responsabilite"> Des responsabilitÃ©s importantes</label>
    <label><input type="checkbox" name="valeurs[]" value="autonomie"> Travailler de maniÃ¨re autonome</label>
    <label><input type="checkbox" name="valeurs[]" value="equipe"> Un bon esprit dâ€™Ã©quipe</label>
  </div>

  <hr>

  <h4>ğŸ§­ Votre maniÃ¨re de travailler</h4>
  <div class="etiquettes">
    <label><input type="checkbox" name="travail[]" value="methodique"> Je suis mÃ©thodique et jâ€™aime planifier</label>
    <label><input type="checkbox" name="travail[]" value="pratique"> Jâ€™apprends mieux en pratiquant</label>
    <label><input type="checkbox" name="travail[]" value="collaboratif"> Jâ€™aime travailler en groupe</label>
    <label><input type="checkbox" name="travail[]" value="independant"> Je prÃ©fÃ¨re travailler seul(e)</label>
    <label><input type="checkbox" name="travail[]" value="creatif"> Jâ€™aime proposer des idÃ©es nouvelles</label>
    <label><input type="checkbox" name="travail[]" value="objectif"> Je me fixe des objectifs prÃ©cis</label>
  </div>

  <hr>

  <label>
    Comment vous dÃ©cririez-vous en quelques mots ?
    <textarea name="projet_passions" placeholder="Parlez un peu de vous : vos passions, votre personnalitÃ©, vos valeurs, votre maniÃ¨re de travailler..."></textarea>
  </label>

  <div class="actions nav-global">
    <button type="button" class="btn prev">â¬…ï¸ Ã‰tape prÃ©cÃ©dente</button>
    <button type="button" class="btn primary next">â¡ï¸ Ã‰tape suivante</button>
    <button type="button" class="btn save">ğŸ’¾ Enregistrer et reprendre plus tard</button>
  </div>
</div>



<!-- ğŸ“ Ã‰tape 5 -->
<div id="tab5" class="tab">


  <h3 style="text-align:center; color:#111; border-bottom:3px solid #f4c45a; padding-bottom:8px; margin-bottom:25px;">
    ğŸ“ PiÃ¨ces justificatives Ã  transmettre
  </h3>

  <div class="grid">

    <!-- ğŸªª Carte dâ€™identitÃ© / Passeport -->
    <div class="justif-block">
      <h4>ğŸªª Carte dâ€™identitÃ© / Passeport</h4>
      <div class="justif-inner">
        <label>Recto (obligatoire)
          <input type="file" name="ci" accept="application/pdf,image/*" required>
        </label>
        <label>Verso (facultatif)
          <input type="file" name="ci2" accept="application/pdf,image/*">
        </label>
      </div>
    </div>

    <!-- ğŸ“¸ Photo dâ€™identitÃ© -->
    <div class="photo-block">
      <h4>ğŸ“¸ Photo dâ€™identitÃ©</h4>
      <div class="photo-inner">
        <div class="photo-upload">
          <label>Importer votre photo :
            <input type="file" name="photo" accept="image/*" required>
          </label>
        </div>
        <div class="photo-example">
          <img src="{{ url_for('static', filename='photo-exemple.png') }}" alt="Exemples de photos" />
          <p><span class="ok">âœ… Photo nette, fond neutre</span> â€” <span class="no">âŒ Pas de selfie ni dâ€™arriÃ¨re-plan visible</span></p>
        </div>
      </div>
    </div>

    <!-- ğŸ’³ Carte Vitale -->
    <div class="justif-block">
      <h4>ğŸ’³ Carte Vitale (PDF uniquement)</h4>
      <label><input type="file" name="carte_vitale" accept="application/pdf" required></label>
    </div>

    <!-- ğŸ“„ CV -->
    <div class="justif-block">
      <h4>ğŸ“„ CV (PDF)</h4>
      <label><input type="file" name="cv" accept="application/pdf" required></label>
    </div>

    <!-- ğŸ–‹ï¸ Lettre de motivation -->
    <div class="justif-block">
      <h4>ğŸ–‹ï¸ Lettre de motivation (PDF)</h4>
      <label><input type="file" name="lm" accept="application/pdf" required></label>
    </div>

  </div>

 <div class="actions nav-global">
  <button type="button" class="btn prev">â¬…ï¸ Ã‰tape prÃ©cÃ©dente</button>
  <button class="btn primary" type="submit">âœ… Envoyer ma prÃ©-inscription</button>
  <button type="button" class="btn save">ğŸ’¾ Enregistrer et reprendre plus tard</button>
</div>

</div>



  </form>
</div>

<script>
// --- VÃ©rification du NIR (avec 2A / 2B autorisÃ©s et conservÃ©s) ---
function verifierNumSecu() {
  const input = document.getElementById("num_secu");
  const help = document.getElementById("numSecuHelp");
  let val = input.value.trim().toUpperCase();
  let nir = val.replace(/\s+/g, "");

  // âœ… Autoriser chiffres et lettres A/B
  if (!/^[0-9AB]{13,15}$/.test(nir)) {
    help.textContent = "âŒ Format invalide â€” seuls chiffres et A/B sont autorisÃ©s (15 caractÃ¨res attendus)";
    help.style.color = "red";
    input.style.borderColor = "red";
    return false;
  }

  // ğŸ” copie pour le calcul (convertit seulement temporairement 2A / 2B)
  const nirCalc = nir.replace("2A", "19").replace("2B", "18");
  const digits = nirCalc.replace(/\D/g, "");

  if (digits.length !== 15) {
    help.textContent = "âŒ NumÃ©ro incomplet â€” 15 chiffres attendus (A/B acceptÃ©s pour la Corse)";
    help.style.color = "red";
    input.style.borderColor = "red";
    return false;
  }

  // âœ… VÃ©rification de la clÃ© de contrÃ´le
  try {
    const corps = digits.slice(0, 13);
    const cle = parseInt(digits.slice(13, 15), 10);
    const calc = 97n - (BigInt(corps) % 97n);
    if (Number(calc) !== cle) {
      help.textContent = "âŒ ClÃ© de contrÃ´le incorrecte";
      help.style.color = "red";
      input.style.borderColor = "red";
      return false;
    }
  } catch {
    help.textContent = "âŒ Format invalide";
    help.style.color = "red";
    input.style.borderColor = "red";
    return false;
  }

  // âœ… CohÃ©rence avec date de naissance et sexe
  const dateInput = document.querySelector('input[name="date_naissance"]');
  const sexeSelect = document.querySelector('select[name="sexe"]');
  const s = parseInt(digits[0], 10);
  const yy = digits.slice(1, 3);
  const mm = digits.slice(3, 5);

  if (dateInput && dateInput.value) {
    const d = new Date(dateInput.value);
    const yyExpected = String(d.getFullYear()).slice(-2);
    const mmExpected = String(d.getMonth() + 1).padStart(2, "0");

    if (yy !== yyExpected) {
      help.textContent = `âŒ AnnÃ©e ${yy} incohÃ©rente (attendu ${yyExpected})`;
      help.style.color = "red";
      input.style.borderColor = "red";
      return false;
    }

    if (/^0[1-9]|1[0-2]$/.test(mm) && mm !== mmExpected) {
      help.textContent = `âŒ Mois ${mm} incohÃ©rent (attendu ${mmExpected})`;
      help.style.color = "red";
      input.style.borderColor = "red";
      return false;
    }
  }

  if (sexeSelect && sexeSelect.value) {
    const valSexe = sexeSelect.value.toLowerCase();
    if ((valSexe === "homme" && s !== 1) || (valSexe === "femme" && s !== 2)) {
      help.textContent = "âŒ Sexe incohÃ©rent avec le NIR";
      help.style.color = "red";
      input.style.borderColor = "red";
      return false;
    }
  }

  // âœ… Tout est bon
  help.textContent = "âœ… NumÃ©ro valide et cohÃ©rent";
  help.style.color = "green";
  input.style.borderColor = "#28a745";
  return true;
}

// VÃ©rification automatique Ã  chaque saisie
["input", "change"].forEach(evt => {
  document.getElementById("num_secu")?.addEventListener(evt, verifierNumSecu);
  document.querySelector('input[name="date_naissance"]')?.addEventListener(evt, verifierNumSecu);
  document.querySelector('select[name="sexe"]')?.addEventListener(evt, verifierNumSecu);
});
</script>

{% if saved_data %}
<script>
  const saved = {{ saved_data|tojson|safe }};
  const step = {{ step|default(0) }};
  document.addEventListener("DOMContentLoaded", () => {
    if (saved) {
      for (const [key, value] of Object.entries(saved)) {
        const field = document.querySelector(`[name="${key}"]`);
        if (field) {
          if (field.type === "checkbox" || field.type === "radio") {
            field.checked = (field.value === value || value === "on");
          } else {
            field.value = value;
          }
        }
      }
      if (typeof showStep === "function") {
        showStep(step);
      }
      alert("âœ… Vos informations prÃ©cÃ©dentes ont Ã©tÃ© rechargÃ©es automatiquement.");
    }
  });
</script>
{% endif %}

<style>
/* --- Style validation et chargement --- */
input.invalid, select.invalid, textarea.invalid {
  border:2px solid red !important;
  background:#ffeaea !important;
}

.sending-overlay {
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(255,255,255,0.9);
  z-index: 9999;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
}
.sending-box {
  text-align:center;
  background:#fff;
  padding:30px 40px;
  border-radius:12px;
  box-shadow:0 4px 14px rgba(0,0,0,0.2);
  animation:fadeIn .3s ease;
}
.loader {
  border:4px solid #eee;
  border-top:4px solid #f4c45a;
  border-radius:50%;
  width:45px; height:45px;
  margin:auto;
  margin-bottom:20px;
  animation:spin 1s linear infinite;
}
@keyframes spin { 0%{transform:rotate(0);} 100%{transform:rotate(360deg);} }
#bloc-resp-legal {
  background:#fff8e1;
  border:2px solid #f4c45a;
  border-radius:10px;
  padding:20px;
  margin-top:20px;
  box-shadow:0 3px 10px rgba(0,0,0,0.1);
}
#bloc-resp-legal h4 {
  text-align:center;
  margin-top:0;
}
</style>



{% endblock %}




