{% extends "base.html" %}
{% block body_class %}public-page{% endblock %}
{% block content %}
<div style="max-width:700px;margin:50px auto;background:white;padding:40px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.1);">
  <h2 style="text-align:center;color:#111;">📎 Remplacement des pièces non conformes</h2>

  <p>Bonjour {{ prenom }}, merci de renvoyer uniquement les pièces signalées comme non conformes.</p>

  <form method="POST" enctype="multipart/form-data" action="/replace-files">
    <input type="hidden" name="token" value="{{ token }}">
    <input type="hidden" name="sig" value="{{ sig }}">

    {% for piece in pieces %}
      {% set pl = piece|lower %}
      {% set type_piece = "" %}

      {# PHOTO d’abord pour ne pas matcher "identité" #}
      {% if "photo d’identité" in pl or "photo d'identité" in pl or pl.startswith("📸") or " photo " in pl %}
        {% set type_piece = "photo" %}

      {# CI / PASSEPORT #}
      {% elif "carte d’identité" in pl or "carte d'identité" in pl or "passeport" in pl or pl.startswith("🪪") %}
        {% set type_piece = "ci" %}

      {# CARTE VITALE #}
      {% elif "carte vitale" in pl or "vitale" in pl or pl.startswith("💳") %}
        {% set type_piece = "carte_vitale" %}

      {# CV #}
      {% elif " cv" in pl or "cv_" in pl or pl.startswith("📄") %}
        {% set type_piece = "cv" %}

      {# LETTRE DE MOTIVATION #}
      {% elif "lettre de motivation" in pl or "motivation" in pl or pl.startswith("🖋️") %}
        {% set type_piece = "lm" %}
      {% endif %}

      <div style="margin:20px 0;padding:15px;border:1px solid #ccc;border-radius:8px;">
        <p style="margin:0;font-weight:600;">{{ piece }}</p>
        <input type="file" name="{{ type_piece or ('piece_' ~ loop.index) }}" required style="margin-top:8px;">
      </div>
    {% endfor %}

    {% if commentaire %}
    <div style="margin-top:25px;padding:12px;background:#fff8e1;border-radius:6px;">
      <strong>🗒️ Commentaire de l’équipe :</strong>
      <p style="margin:6px 0 0;">{{ commentaire }}</p>
    </div>
    {% endif %}

    <div style="text-align:center;margin-top:30px;">
      <button type="submit" class="btn primary" style="background:#28a745;color:white;padding:12px 20px;border:none;border-radius:8px;font-size:16px;">
        📤 Envoyer mes nouveaux documents
      </button>
    </div>
  </form>
</div>
{% endblock %}
