{% extends "base.html" %}
{% block body_class %}parcoursup-page{% endblock %}
{% block content %}

<div class="container" style="padding:30px;">
  <h2>ğŸ“ Gestion Parcoursup</h2>
  <p>Importez les candidatures Parcoursup et gÃ©rez leur suivi ici.</p>

  <hr>

  <form method="post" enctype="multipart/form-data" style="margin-bottom:20px;">
    <label for="file" style="font-weight:600;">ğŸ“¤ Importer ou vÃ©rifier un fichier Excel (.xlsx)</label><br>
    <input type="file" name="file" accept=".xlsx" required>

    <!-- ğŸ•µï¸â€â™‚ï¸ Bouton de vÃ©rification -->
    <button formaction="{{ url_for('parcoursup.check_file') }}" class="btn secondary">
      ğŸ•µï¸â€â™‚ï¸ VÃ©rifier le fichier
    </button>

    <!-- ğŸ“¥ Bouton dâ€™import -->
    <button formaction="{{ url_for('parcoursup.import_file') }}" class="btn primary" style="margin-left:10px;">
      ğŸ“¥ Importer les candidatures
    </button>
  </form>

  <hr>

  <!-- ğŸ” Barre de filtre -->
  <form method="get" action="{{ url_for('parcoursup.dashboard') }}" style="margin-bottom:20px;display:flex;gap:10px;align-items:center;">
    <label for="statut" style="font-weight:600;">ğŸ¯ Filtrer par statut :</label>
    <select id="statut" name="statut" style="padding:5px 10px;border-radius:6px;">
      <option value="">Tous les statuts</option>
      {% for key, value in STATUTS_STYLE.items() %}
        <option value="{{ key }}" {% if request.args.get('statut') == key %}selected{% endif %}>
          {{ value[0] }}
        </option>
      {% endfor %}
    </select>
    <button type="submit" class="btn primary">Filtrer</button>
    <a href="{{ url_for('parcoursup.dashboard') }}" class="btn secondary">â†» RÃ©initialiser</a>
  </form>

  <h3>ğŸ“‹ Liste des candidats Parcoursup</h3>
  {% if rows %}
  <table border="1" cellpadding="8" cellspacing="0" style="width:100%;border-collapse:collapse;">
    <thead style="background:#f4c45a;">
      <tr>
        <th>Nom</th>
        <th>PrÃ©nom</th>
        <th>TÃ©lÃ©phone</th>
        <th>Email</th>
        <th>Formation</th>
        <th>Mode</th>
        <th>Mail OK</th>
        <th>SMS OK</th>
        <th>Statut</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ r.nom }}</td>
        <td>{{ r.prenom }}</td>
        <td>{{ r.telephone }}</td>
        <td>{{ r.email }}</td>
        <td>{{ r.formation }}</td>
        <td>{{ r.mode }}</td>
        <td>{% if r.mail_ok %}âœ…{% else %}âŒ{% endif %}</td>
        <td>{% if r.sms_ok %}âœ…{% else %}âŒ{% endif %}</td>

        {% set libelle, couleur = STATUTS_STYLE.get(r.statut, (r.statut, '#ccc')) %}
        <td style="background:{{ couleur }};color:#fff;font-weight:600;text-align:center;border-radius:6px;padding:4px 8px;">
          {{ libelle }}
        </td>

        <td style="text-align:center;">
          <form action="{{ url_for('parcoursup.delete_candidat', cid=r.id) }}" method="post" style="display:inline;">
            <button type="submit" class="btn small danger" onclick="return confirm('Supprimer cette candidature ?')">ğŸ—‘ï¸</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>Aucune candidature importÃ©e pour le moment.</p>
  {% endif %}
</div>

{% endblock %}
