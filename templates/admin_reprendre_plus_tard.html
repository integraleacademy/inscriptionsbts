{% extends "base.html" %}
{% block content %}

<div style="max-width:900px;margin:30px auto;background:#fff;padding:25px;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.08);">

  <h2>‚è≥ Brouillons ‚Äî Reprendre plus tard</h2>

  {% if rows %}
  <table style="width:100%;border-collapse:collapse;">
    <thead>
      <tr style="background:#f4c45a;color:#111;">
        <th style="padding:10px;">Nom</th>
        <th style="padding:10px;">Pr√©nom</th>
        <th style="padding:10px;">Email</th>
        <th style="padding:10px;">BTS</th>
        <th style="padding:10px;">Date</th>
        <th style="padding:10px;">Action</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr style="border-bottom:1px solid #ddd;" data-id="{{ r.id }}">
        <td style="padding:8px;">{{ r.nom }}</td>
        <td style="padding:8px;">{{ r.prenom }}</td>
        <td style="padding:8px;">{{ r.email }}</td>
        <td style="padding:8px;">{{ r.bts }}</td>
        <td style="padding:8px;">
          {% if r.updated_at %}
            {{ r.updated_at[:16].replace('T',' √† ') }}
          {% else %}
            ‚Äî
          {% endif %}
        </td>
        <td style="padding:8px;display:flex;gap:6px;">

          <!-- üîó Ouvrir le brouillon -->
          <a href="{{ r.resume_link }}" target="_blank"
             style="background:#007bff;color:white;padding:6px 10px;border-radius:6px;text-decoration:none;font-weight:600;">
             üîó Ouvrir
          </a>

          <!-- üóëÔ∏è Supprimer -->
          <button onclick="deleteDraft('{{ r.id }}')"
                  style="background:#dc3545;color:white;padding:6px 10px;border-radius:6px;font-weight:600;border:none;cursor:pointer;">
            üóëÔ∏è Supprimer
          </button>

        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% else %}

  <p style="text-align:center;font-size:17px;color:#555;margin-top:40px;">
      Aucun brouillon enregistr√©.
  </p>

  {% endif %}

</div>

<!-- ========================== -->
<!-- üöÆ SCRIPT SUPPRESSION -->
<!-- ========================== -->
<script>
async function deleteDraft(token) {
    if (!confirm("‚ö†Ô∏è Supprimer ce brouillon ?")) return;

    try {
        const res = await fetch(`/admin/reprendre-plus-tard/delete/${token}`, {
            method: "POST"
        });

        const data = await res.json();

        if (data.ok) {
            // Supprimer instantan√©ment la ligne dans le tableau
            const row = document.querySelector(`tr[data-id="${token}"]`);
            if (row) row.remove();
        } else {
            alert("Erreur : " + (data.error || "inconnue"));
        }

    } catch (error) {
        alert("Une erreur est survenue : " + error);
        console.error(error);
    }
}
</script>

{% endblock %}
