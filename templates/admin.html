{% extends "base.html" %}
{% block content %}
<h2>Administration</h2>
<div class="toolbar">
  <form method="get" action="{{ url_for('admin') }}" class="filters">
    <input type="text" name="q" placeholder="Rechercher (nom, pr√©nom, mail, BTS...)" value="{{ request.args.get('q','') }}">
    <select name="bts">
      <option value="">BTS (tous)</option>
      <option value="MOS">MOS</option><option value="MCO">MCO</option><option value="PI">PI</option>
      <option value="CI">CI</option><option value="NDRC">NDRC</option><option value="CG">CG</option>
    </select>
    <select name="mode">
      <option value="">Mode (tous)</option>
      <option value="presentiel">Pr√©sentiel</option>
      <option value="distanciel">Distanciel</option>
    </select>
    <select name="statut">
      <option value="">Statut (tous)</option>
      {% for key,label,color in statuts %}
        <option value="{{ key }}">{{ label }}</option>
      {% endfor %}
    </select>
    <select name="label">
      <option value="">√âtiquette</option>
      <option value="APS">APS</option>
      <option value="AUT">AUT OK</option>
      <option value="CHEQUE">Ch√®que OK</option>
    </select>
    <button class="btn">Filtrer</button>
    <a class="btn" href="{{ url_for('admin') }}">R√©initialiser</a>
  </form>
  <div class="exports">
    <a class="btn" href="{{ url_for('admin_export_csv') }}">Export CSV</a>
    <a class="btn" href="{{ url_for('admin_export_json') }}">Export JSON</a>
  </div>
</div>
<table class="admin-table">
  <thead>
    <tr>
      <th>Nom</th><th>Pr√©nom</th><th>BTS</th><th>Mode</th><th>T√©l√©phone</th><th>Statut</th><th>√âtiquettes</th><th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for r in rows %}
    <tr data-id="{{ r.id }}">
      <td contenteditable="true" data-field="nom">{{ r.nom }}</td>
      <td contenteditable="true" data-field="prenom">{{ r.prenom }}</td>
      <td contenteditable="true" data-field="bts">{{ r.bts }}</td>
      <td contenteditable="true" data-field="mode">{{ r.mode }}</td>
      <td contenteditable="true" data-field="tel">{{ r.tel }}</td>
      <td>
        <select data-field="statut" class="status-select">
          {% for key,label,color in statuts %}
            <option value="{{ key }}" {% if r.statut==key %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </td>
      <td>
        <label><input type="checkbox" class="chk" data-field="label_aps" {% if r.label_aps %}checked{% endif %}> APS</label>
        <label><input type="checkbox" class="chk" data-field="label_aut_ok" {% if r.label_aut_ok %}checked{% endif %}> AUT OK</label>
        <label><input type="checkbox" class="chk" data-field="label_cheque_ok" {% if r.label_cheque_ok %}checked{% endif %}> Ch√®que OK</label>
      </td>
      <td><button class="btn small" onclick="openActionsModal('{{ r.id }}')">‚ãØ</button></td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div id="actionsModal" class="modal hidden">
  <div class="modal-content">
    <h3>Actions</h3>
    <div class="modal-actions">
      <a id="printLink" class="btn">üñ®Ô∏è Imprimer la fiche (PDF)</a>
      <button id="reconfirmBtn" class="btn">üîÅ Reconfirmation inscription</button>
      <button id="deleteBtn" class="btn danger">üóëÔ∏è Supprimer</button>
    </div>
    <hr>
    <h4>Commentaires</h4>
    <textarea id="commentBox" rows="4" placeholder="Ajouter / modifier un commentaire‚Ä¶"></textarea>
    <div style="margin-top:8px">
      <button id="saveCommentBtn" class="btn primary">Enregistrer le commentaire</button>
    </div>
    <div class="modal-close"><button class="btn" onclick="closeActionsModal()">Fermer</button></div>
  </div>
</div>
{% endblock %}
